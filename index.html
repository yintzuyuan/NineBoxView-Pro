<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NineBoxView Pro</title>
  <meta name="description" content="Nine-grid preview tool for Glyphs 3.">

  <!-- Alternate Languages -->
  <link rel="alternate" hreflang="zh-Hant" href="https://yintzuyuan.github.io/NineBoxView-Pro/zh-Hant/">
  <link rel="alternate" hreflang="en" href="https://yintzuyuan.github.io/NineBoxView-Pro/en/">
  <link rel="alternate" hreflang="zh-Hans" href="https://yintzuyuan.github.io/NineBoxView-Pro/zh-Hans/">
  <link rel="alternate" hreflang="ja" href="https://yintzuyuan.github.io/NineBoxView-Pro/ja/">
  <link rel="alternate" hreflang="ko" href="https://yintzuyuan.github.io/NineBoxView-Pro/ko/">
  <link rel="alternate" hreflang="x-default" href="https://yintzuyuan.github.io/NineBoxView-Pro/">

  <!-- Redirect will happen via JS, but provide meta refresh as fallback -->
  <meta http-equiv="refresh" content="0;url=zh-Hant/index.html">

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">

  <style>
    body {
      font-family: system-ui, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      background: #f8f6f0;
    }
    .loading {
      text-align: center;
      color: #666;
    }
  </style>
  <!-- Umami Analytics -->
  <script defer src="https://analytics.erikyin.net/script.js" data-website-id="e186edab-7c13-4f03-b72e-353ea300595c"></script>
</head>
<body>
  <div class="loading">
    <p>Redirecting...</p>
  </div>

  <script>
    (function() {
      'use strict';

      var LANG_CONFIG = {
        'zh-Hant': { path: 'zh-Hant/', aliases: ['zh-TW', 'zh-Hant', 'zh'] },
        'en': { path: 'en/', aliases: ['en', 'en-US', 'en-GB', 'en-AU'] },
        'zh-Hans': { path: 'zh-Hans/', aliases: ['zh-CN', 'zh-Hans', 'zh-SG'] },
        'ja': { path: 'ja/', aliases: ['ja', 'ja-JP'] },
        'ko': { path: 'ko/', aliases: ['ko', 'ko-KR'] }
      };

      var DEFAULT_LANG = 'zh-Hant';
      var STORAGE_KEY = 'nineboxview_lang';

      function normalizeLangCode(code) {
        if (!code) return null;
        var lowerCode = code.toLowerCase();

        for (var lang in LANG_CONFIG) {
          var aliases = LANG_CONFIG[lang].aliases;
          for (var i = 0; i < aliases.length; i++) {
            if (lowerCode === aliases[i].toLowerCase() ||
                lowerCode.startsWith(aliases[i].toLowerCase() + '-')) {
              return lang;
            }
          }
        }

        if (lowerCode === 'zh' || lowerCode.startsWith('zh-')) {
          return DEFAULT_LANG;
        }
        return null;
      }

      function detectLanguage() {
        // 1. URL parameter
        var params = new URLSearchParams(window.location.search);
        var langParam = params.get('lang');
        if (langParam) {
          var normalized = normalizeLangCode(langParam);
          if (normalized) {
            localStorage.setItem(STORAGE_KEY, normalized);
            return normalized;
          }
        }

        // 2. localStorage
        var stored = localStorage.getItem(STORAGE_KEY);
        if (stored && LANG_CONFIG[stored]) {
          return stored;
        }

        // 3. Browser language
        var browserLangs = navigator.languages || [navigator.language];
        for (var i = 0; i < browserLangs.length; i++) {
          var normalized = normalizeLangCode(browserLangs[i]);
          if (normalized) return normalized;
        }

        return DEFAULT_LANG;
      }

      var targetLang = detectLanguage();
      var targetPath = LANG_CONFIG[targetLang].path + 'index.html';

      // Preserve hash
      var hash = window.location.hash;
      window.location.replace(targetPath + hash);
    })();
  </script>

  <!-- Fallback for no-JS -->
  <noscript>
    <p>Please enable JavaScript or <a href="zh-Hant/index.html">click here</a> to continue.</p>
  </noscript>
</body>
</html>
